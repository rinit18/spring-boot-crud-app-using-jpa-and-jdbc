<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
<div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-6">üéì Student Management System</h1>

    <!-- Add Student Form -->
    <form id="studentForm" class="bg-white shadow-md rounded-lg p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="hidden" id="studentId" />
            <input
                    type="text"
                    id="name"
                    placeholder="Enter Name"
                    class="border rounded p-2 w-full"
                    required
            />
            <input
                    type="text"
                    id="email"
                    placeholder="Enter Email"
                    class="border rounded p-2 w-full"
                    required
            />
            <input
                    type="text"
                    id="course"
                    placeholder="Enter Course"
                    class="border rounded p-2 w-full"
                    required
            />
        </div>
        <button
                type="submit"
                class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition duration-200"
        >
            Save Student
        </button>
    </form>

    <!-- Students Table -->
    <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table class="w-full border-collapse">
            <thead>
            <tr class="bg-gray-200">
                <th class="border px-4 py-2">ID</th>
                <th class="border px-4 py-2">Name</th>
                <th class="border px-4 py-2">Email</th>
                <th class="border px-4 py-2">Course</th>
                <th class="border px-4 py-2">Actions</th>
            </tr>
            </thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>
</div>

<script>
    // ‚úÖ Relative API URL (works both locally & on Railway)
    const API_URL = '/students';

    async function loadStudents() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error('Failed to fetch students');
            const students = await response.json();

            const table = document.getElementById('studentTable');
            table.innerHTML = '';

            students.forEach((student) => {
                const row = `
            <tr>
              <td class="border px-4 py-2">${student.id}</td>
              <td class="border px-4 py-2">${student.name}</td>
              <td class="border px-4 py-2">${student.email}</td>
              <td class="border px-4 py-2">${student.course}</td>
              <td class="border px-4 py-2 text-center">
                <button onclick="editStudent(${student.id}, '${student.name}', '${student.email}', '${student.course}')"
                        class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded">
                  Edit
                </button>
                <button onclick="deleteStudent(${student.id})"
                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded ml-2">
                  Delete
                </button>
              </td>
            </tr>`;
                table.innerHTML += row;
            });
        } catch (error) {
            console.error('Error loading students:', error);
            document.getElementById('studentTable').innerHTML =
                `<tr><td colspan="5" class="text-center text-red-600 py-4">‚ö†Ô∏è Could not load student data.</td></tr>`;
        }
    }

    async function saveStudent(event) {
        event.preventDefault();

        const id = document.getElementById('studentId').value;
        const student = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            course: document.getElementById('course').value,
        };

        const method = id ? 'PUT' : 'POST';
        const url = id ? `${API_URL}/${id}` : API_URL;

        try {
            const response = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(student),
            });

            if (!response.ok) throw new Error('Failed to save student');

            await loadStudents();
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
        } catch (error) {
            console.error('Error saving student:', error);
            alert('‚ö†Ô∏è Failed to save student. Please try again.');
        }
    }

    function editStudent(id, name, email, course) {
        document.getElementById('studentId').value = id;
        document.getElementById('name').value = name;
        document.getElementById('email').value = email;
        document.getElementById('course').value = course;
    }

    async function deleteStudent(id) {
        if (!confirm('Are you sure you want to delete this student?')) return;
        try {
            const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
            if (!response.ok) throw new Error('Failed to delete student');
            await loadStudents();
        } catch (error) {
            console.error('Error deleting student:', error);
            alert('‚ö†Ô∏è Failed to delete student. Please try again.');
        }
    }

    document.getElementById('studentForm').addEventListener('submit', saveStudent);
    window.onload = loadStudents;
</script>
</body>
</html>
